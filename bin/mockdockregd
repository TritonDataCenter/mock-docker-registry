#!/usr/bin/env node

var fs = require('fs');
var path = require('path');

var App = require('../lib/app');


// ---- support functions

function loadConfigSync() {
    var configPath = path.resolve(__dirname + '/../etc/config.json');
    var content = fs.readFileSync(configPath);
    var config = JSON.parse(content);

    // Some paths are relative to the config file, so the config file dir may
    // be needed.
    config._configDir = path.dirname(configPath);

    return config;
}


// ---- mainline

function main() {
    var app = new App({config: loadConfigSync()});

    app.start(function appStarted(err) {
        if (err) {
            app.log.error(err, 'error starting app');
            process.exitStatus = 1;
        } else {
            app.log.info('app started');
        }
    });
}

main();
